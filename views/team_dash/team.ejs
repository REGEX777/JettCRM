<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/output.css">
    <script src="https://kit.fontawesome.com/82eb69e53c.js" crossorigin="anonymous"></script>
    <link href="https://cdn.jsdelivr.net/npm/flowbite@3.1.2/dist/flowbite.min.css" rel="stylesheet" />
    <title>Team Members</title>
</head>

<body>
    <!-- Parent -->
    <% if (success.length > 0) { %>
    <div class="h-10 w-full bg-green-500 flex items-center justify-center">
        <p><%= success[0] %></p>
    </div>
    <% } %>

    <% if (error.length > 0) { %>
    <div class="h-10 w-full bg-red-500">
        <p><%= error[0] %></p>
    </div>
    <% } %>
    <div class="flex flex-row justify-start">

        <%- include('../fragments/sidebar'); -%>

        <div
            class="flex flex-col min-h-screen bg-[#FAFAFA] px-10 py-5 pt-10 font-poppins ml-[24rem] w-[calc(100%-24rem)] gap-3">
            <div class="h-[4rem] rounded-lg w-full bg-white flex items-center justify-between px-10">
                <p class="font-medium">Team Members</p>
                <div class="flex items-center gap-4">
                    <button id="dropdownHoverButton" data-dropdown-toggle="dropdownHover"
                        class="flex flex-row items-center justify-center gap-2 hover:bg-border p-1 rounded-lg"
                        type="button">
                        <i class="fa-solid fa-angle-down"></i>
                        <img alt="profilepic"
                            src="https://www.tlgtrucks.com/Portals/0/adam/Swiper/t-n2Vp1v2025DnecF67fuA/Image/peterbilt-launches-new-model-589-1.jpg?mode=max&w=1920"
                            class="h-10 w-10 bg-[#D9D9D9] rounded-lg">
                    </button>
                </div>

                <div id="dropdownHover"
                    class="z-50 hidden bg-white divide-y divide-gray-100 rounded-lg shadow w-44 dark:bg-gray-700">
                    <ul class="py-2 text-sm text-gray-700 dark:text-gray-200" aria-labelledby="dropdownHoverButton">
                        <li>
                            <a href="#"
                                class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white">Settings</a>
                        </li>
                        <li>
                            <a href="#"
                                class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white">Sign
                                out</a>
                        </li>
                    </ul>
                </div>
            </div>

            <div class="min-h-[4rem] rounded-lg w-full bg-white flex items-center justify-between px-5 py-3">
                <div class="relative w-1/3">
                    <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                        <i class="fa-solid fa-magnifying-glass text-gray-400"></i>
                    </div>
                    <input type="text" id="teamSearch"
                        class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full pl-10 p-2.5"
                        placeholder="Search team members...">
                </div>
                <div class="flex gap-3">
                    <a href="/team/add" class="py-2 px-4 bg-[#3546FF] text-white rounded-lg flex items-center gap-2">
                        <i class="fa-solid fa-plus"></i>
                        <span>Add Member</span>
                    </a>

                    <button id="departmentDropdownButton" data-dropdown-toggle="departmentDropdown"
                        class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg px-10 focus:ring-blue-500 focus:border-blue-500 block p-2.5 w-[10rem]">
                        All Departments <i class="fa-solid fa-angle-down pl-2"></i>
                    </button>
                    <div id="departmentDropdown"
                        class="z-10 hidden bg-white divide-y divide-gray-100 rounded-lg shadow-sm w-44 dark:bg-gray-700">
                        <ul class="py-2 text-sm text-gray-700 dark:text-gray-200"
                            aria-labelledby="dropdownDefaultButton">
                            <li>
                                <a href="/team?department=all"
                                    class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white">All</a>
                            </li>
                            <li>
                                <a href="/team?department=design"
                                    class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white">Design</a>
                            </li>
                            <li>
                                <a href="/team?department=development"
                                    class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white">Development</a>
                            </li>
                            <li>
                                <a href="/team?department=marketing"
                                    class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white">Marketing</a>
                            </li>
                            <li>
                                <a href="/team?department=sales"
                                    class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white">Sales</a>
                            </li>
                        </ul>
                    </div>

                    <button id="roleDropdownButton" data-dropdown-toggle="roleDropdown"
                        class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg px-10 focus:ring-blue-500 focus:border-blue-500 block p-2.5 w-[7rem]">
                        All Roles <i class="fa-solid fa-angle-down pl-2"></i>
                    </button>
                    <div id="roleDropdown"
                        class="z-10 hidden bg-white divide-y divide-gray-100 rounded-lg shadow-sm w-44 dark:bg-gray-700">
                        <ul class="py-2 text-sm text-gray-700 dark:text-gray-200"
                            aria-labelledby="dropdownDefaultButton">
                            <li>
                                <a href="/team?role=all"
                                    class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white">All</a>
                            </li>
                            <li>
                                <a href="/team?role=admin"
                                    class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white">Admin</a>
                            </li>
                            <li>
                                <a href="/team?role=manager"
                                    class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white">Manager</a>
                            </li>
                            <li>
                                <a href="/team?role=developer"
                                    class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white">Developer</a>
                            </li>
                            <li>
                                <a href="/team?role=designer"
                                    class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white">Designer</a>
                            </li>
                        </ul>
                    </div>

                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5">

                <% teamMembers.forEach((member, index) => { %>
                <div class="bg-white rounded-lg border border-border p-5 flex flex-col gap-4" data-id="<%= member._id %>">
                    <div class="flex items-center gap-4">
                        <img src="https://ui-avatars.com/api/?name=<%= member.firstName%>+<%= member.lastName %>&background=random"
                            class="w-16 h-16 rounded-full">
                        <div>
                            <h3 class="font-semibold"><%= member.firstName + " " + member.lastName %></h3>
                            <p class="text-sm text-gray-500"><%= member.role %></p>
                        </div>
                    </div>

                    <div class="grid grid-cols-2 gap-3 text-sm">
                        <div>
                            <p class="text-gray-500">Department</p>
                            <p class="font-medium"><%= member.department %></p>
                        </div>
                        <div>
                            <p class="text-gray-500">Joined</p>
                            <p class="font-medium"><%= member.joinDate %></p>
                        </div>
                        <div>
                            <p class="text-gray-500">Salary</p>
                            <p class="font-medium">$<%= member.salary %></p>
                        </div>
                        <div class="text-sm">
                            <p class="text-gray-500">Status</p>
                            <div id="status-badge-<%= member._id %>" class="py-1 px-2 rounded-lg inline-block 
                                <%= member.status === 'Active' 
                                    ? 'bg-green-700 border-green-700' 
                                    : 'bg-red-600 border-red-600' %>">
                                <p class="text-xs text-white"><%= member.status %></p>
                            </div>
                        </div>
                    </div>

                    <div class="flex justify-between items-center pt-2 border-t border-border">
                        <div class="flex gap-2">
                            <a href="mailto:<%= member.email %>" class="text-[#3546FF] text-sm flex items-center gap-1">
                                <i class="fa-solid fa-envelope text-xs"></i>
                                <span>Email</span>
                            </a>
                            <p class="text-sm flex items-center gap-1">
                                <i class="fa-solid fa-phone text-xs"></i>
                                <span><%= member.phone %></span>
                            </p>
                        </div>
                        <div class="relative">
                            <button id="threedotsDropdownButton-<%= index %>"
                                data-dropdown-toggle="threedotsDropdown-<%= index %>"
                                class="text-gray-500 hover:text-gray-700 p-2">
                                <i class="fa-solid fa-ellipsis-vertical"></i>
                            </button>
                            <div id="threedotsDropdown-<%= index %>"
                                class="z-10 hidden bg-white divide-y divide-gray-100 rounded-lg shadow-sm w-44 absolute right-0">
                                <ul class="py-2 text-sm text-gray-700">
                                    <li>
                                        <button class="status-btn w-full px-4 py-2 flex items-center justify-between hover:bg-gray-100"
                                                data-id="<%= member._id %>" data-status="Active">
                                            <span>Active</span>
                                            <% if (member.status === 'Active') { %>
                                                <i class="fa-solid fa-check text-green-500"></i>
                                            <% } %>
                                        </button>
                                    </li>
                                    <li>
                                        <button class="status-btn w-full px-4 py-2 flex items-center justify-between hover:bg-gray-100"
                                                data-id="<%= member._id %>" data-status="Inactive">
                                            <span>Inactive</span>
                                            <% if (member.status === 'Inactive') { %>
                                                <i class="fa-solid fa-check text-red-500"></i>
                                            <% } %>
                                        </button>
                                    </li>
                                    <li>
                                        <a href="/team/edit/<%= member._id %>" class="w-full px-4 py-2 flex items-center justify-between hover:bg-gray-100">
                                        Edit
                                        </a>
                                    </li>
                                    <li>
                                        <button type="button" class="delete-member-btn w-full px-4 py-2 flex items-center justify-between hover:bg-gray-100 text-red-600" data-id="<%= member._id %>">
                                        Delete
                                        </button>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <% }); %>
            </div>

            <div class="flex items-center justify-between bg-white rounded-lg border border-border p-4">
                <div class="w-full flex justify-between items-center">
                    <p class="text-sm text-[#A3A3A3]">
                        Showing <%= startEntry %> to <%= endEntry %> of <%= totalTeamMembers %> entries
                    </p>

                    <div class="flex gap-2">
                        <% function renderPageLink(page) { %>
                        <a href="?page=<%= page %>"
                            class="w-8 h-8 flex items-center justify-center border border-border rounded-lg <%= currentPage === page ? 'bg-[#3546FF] text-white' : '' %>">
                            <%= page %>
                        </a>
                        <% } %>

                        <% function renderDots() { %>
                        <span class="w-8 h-8 flex items-center justify-center text-[#C1C1C1]">...</span>
                        <% } %>

                        <% if (currentPage > 1) { %>
                        <a href="?page=<%= currentPage - 1 %>"
                            class="w-8 h-8 flex items-center justify-center border border-border rounded-lg">
                            <i class="fa-solid fa-chevron-left"></i>
                        </a>
                        <% } else { %>
                        <span
                            class="w-8 h-8 flex items-center justify-center text-[#C1C1C1] border border-border rounded-lg cursor-not-allowed">
                            <i class="fa-solid fa-chevron-left"></i>
                        </span>
                        <% } %>

                        <% if (totalPages <= 7) { %>
                        <% for (let i = 1; i <= totalPages; i++) { %>
                        <%= renderPageLink(i) %>
                        <% } %>
                        <% } else { %>
                        <%= renderPageLink(1) %>
                        <% if (currentPage > 4) { renderDots(); } %>

                        <% for (let i = currentPage - 1; i <= currentPage + 1; i++) {
                            if (i > 1 && i < totalPages) {
                        %>
                        <%= renderPageLink(i) %>
                        <% } } %>

                        <% if (currentPage < totalPages - 3) { renderDots(); } %>
                        <%= renderPageLink(totalPages) %>
                        <% } %>

                        <% if (currentPage < totalPages) { %>
                        <a href="?page=<%= currentPage + 1 %>"
                            class="w-8 h-8 flex items-center justify-center border border-border rounded-lg">
                            <i class="fa-solid fa-chevron-right"></i>
                        </a>
                        <% } else { %>
                        <span
                            class="w-8 h-8 flex items-center justify-center text-[#C1C1C1] border border-border rounded-lg cursor-not-allowed">
                            <i class="fa-solid fa-chevron-right"></i>
                        </span>
                        <% } %>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/flowbite@3.1.2/dist/flowbite.min.js"></script>
    <script src="/javascript/team.js"></script>

    <div id="deleteConfirmModal" class="fixed inset-0 z-50 bg-[#00000028] bg-opacity-50 flex items-center justify-center hidden">
        <div class="bg-white rounded-lg shadow-md w-80 p-6">
            <h2 class="text-lg font-semibold text-gray-800 mb-4">Confirm Deletion</h2>
            <p class="text-sm text-gray-600 mb-6">Are you sure you want to delete this team member?</p>
            <form id="deleteForm" method="POST" action="/team/api/delete">
            <input type="hidden" name="id" id="deleteMemberId">
            <div class="flex justify-end gap-2">
                <button type="button" id="cancelDeleteBtn" class="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300 text-sm">Cancel</button>
                <button type="submit" class="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 text-sm">Delete</button>
            </div>
            </form>
        </div>
    </div>
</body>

</html>