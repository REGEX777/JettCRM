<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/output.css">
    <script src="https://kit.fontawesome.com/82eb69e53c.js" crossorigin="anonymous"></script>
    <link href="https://cdn.jsdelivr.net/npm/flowbite@3.1.2/dist/flowbite.min.css" rel="stylesheet" />
    <title>Document</title>
</head>

<body>
    <!-- Parent -->
    <% if (success.length > 0) { %>
    <div class="h-10 w-full bg-green-500 flex items-center justify-center">
        <p><%= success[0] %></p>
    </div>
    <% } %>

    <% if (error.length > 0) { %>
    <div class="h-10 w-full bg-red-500">
        <p><%= error[0] %></p>
    </div>
    <% } %>
    <div class="flex flex-row justify-start">

        <%- include('../fragments/sidebar'); -%>

        <div class="flex flex-col bg-[#FAFAFA] px-10 py-5 pt-10 font-poppins ml-[24rem] w-[calc(100%-24rem)] gap-3">
            <%- include('../fragments/header'); -%>
            <div class="bg-white p-6 rounded-lg shadow-md w-full max-w-3xl">
              <h2 class="text-2xl font-semibold mb-4">Create Estimate</h2>

              <form action="/estimate/create" method="POST" id="estimateForm">
                <div id="itemsContainer" class="space-y-4">
                  <div class="flex items-center gap-4">
                    <input name="items[0][name]" type="text" placeholder="Item name" class="flex-1 px-3 py-2 border rounded" required>
                    <input name="items[0][price]" type="number" step="0.01" placeholder="Price" class="w-32 px-3 py-2 border rounded price-input" required>
                    <button type="button" class="text-red-600 remove-btn hidden"><i class="fas fa-trash"></i></button>
                  </div>
                </div>


                
                <div class="mt-4">
                  <button type="button" id="addItem" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
                    <i class="fas fa-plus mr-1"></i> Add Item
                  </button>
                </div>
                <div class="mt-6 space-y-4">
                  <div class="flex items-center gap-4">
                    <label class="w-32 font-medium">Tax (%)</label>
                    <input type="number" name="tax" id="taxInput" class="px-3 py-2 border rounded w-32" placeholder="e.g. 18">
                  </div>

                  <div class="flex items-center gap-4">
                    <label class="w-32 font-medium">Discount</label>
                    <input type="number" name="discount" id="discountInput" class="px-3 py-2 border rounded w-32" placeholder="e.g. 200">
                    <select id="discountType" name="discountType" class="px-2 py-2 border rounded">
                      <option value="flat">₹ Flat</option>
                      <option value="percent">Percentage %</option>
                    </select>
                  </div>
                </div>
                <div class="mt-6">
                  <label class="font-medium">Additional Notes</label>
                  <textarea name="notes" rows="3" class="w-full border rounded px-3 py-2 mt-2" placeholder="Enter any additional terms or notes..."></textarea>
                </div>

                <div class="mt-6 border-t pt-4 space-y-2 text-sm text-gray-700">
                  <p>Subtotal: ₹ <span id="subtotalDisplay">0.00</span></p>
                  <p>Tax: ₹ <span id="taxDisplay">0.00</span></p>
                  <p>Discount: ₹ <span id="discountDisplay">0.00</span></p>
                  <p class="text-lg font-semibold">Total: ₹ <span id="totalDisplay">0.00</span></p>
                </div>
                <div class="mt-6">
                  <button type="submit" class="w-full bg-green-600 text-white py-2 rounded hover:bg-green-700">
                    Submit Estimate
                  </button>
                </div>
              </form>
            </div>

        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/flowbite@3.1.2/dist/flowbite.min.js"></script>
</body>
<script>
  let itemIndex = 1;

  document.getElementById("addItem").addEventListener("click", () => {
    const container = document.getElementById("itemsContainer");

    const newItem = document.createElement("div");
    newItem.className = "flex items-center gap-4";

    newItem.innerHTML = `
      <input name="items[${itemIndex}][name]" type="text" placeholder="Item name" class="flex-1 px-3 py-2 border rounded" required>
      <input name="items[${itemIndex}][price]" type="number" step="0.01" placeholder="Price" class="w-32 px-3 py-2 border rounded price-input" required>
      <button type="button" class="text-red-600 remove-btn"><i class="fas fa-trash"></i></button>
    `;

    container.appendChild(newItem);
    itemIndex++;
    updateTotal();
  });

  document.getElementById("itemsContainer").addEventListener("click", (e) => {
    if (e.target.closest(".remove-btn")) {
      e.target.closest(".remove-btn").parentElement.remove();
      updateTotal();
    }
  });

  document.getElementById("itemsContainer").addEventListener("input", (e) => {
    if (e.target.classList.contains("price-input")) {
      updateTotal();
    }
  });

  function updateTotal() {
    const prices = document.querySelectorAll(".price-input");
    let total = 0;
    prices.forEach(input => {
      const val = parseFloat(input.value);
      if (!isNaN(val)) total += val;
    });
    document.getElementById("totalEstimate").textContent = total.toFixed(2);
  }
</script> 
</html>